<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

      <title>HVL: Dat152</title>
      <meta name="description" content="Page for dat152 presentations">
      <meta name="author" content="Lasse Jenssen">

      <link rel="stylesheet" href="dist/reset.css">
      <link rel="stylesheet" href="dist/reveal.css">
      <link rel="stylesheet" href="dist/theme/white.css">
      <link rel="stylesheet" href="dist/theme/robot-lung.css">

      <!-- Theme used for syntax highlighted code -->
      <link rel="stylesheet" href="plugin/highlight/zenburn.css">

   </head>
   <body>

      <div class="reveal">
         <div class="slides">
				<!-- --------------------------------------------------------
               -- WebServices: A simple web service
               ---------------------------------------------------------- -->
				<section>
					<section data-background="black">
						<img src="images/hvl-logo.png" alt="HVL logo" style="height: 120px; border: none; box-shadow: none;"><br><br>
						<p style="color: #cb4b16; font-size: 40px; margin-bottom: 0px"><b>WebServices: A simple web service</b></p>
						<p style="font-size: 24px;font-style: italic">Created by <a href="http://www.jcon.no/blog">Lasse Jenssen</a></p>
						<p style="font-size: 18px"><a href="index.html">Home</a></p>
					</section>
				</section>
				
				<!-- -------------------------------------------------------------
                -- Spring Initializer
                ------------------------------------------------------------- -->
				<section>

					<section>
						<span style="font-size: 50px">
							<p style="font-style: italic"><b>Spring Initializer</b></p>
							<a href="http://start.spring.io">http://start.spring.io</a>
						</span>
					</section>

					<section style="text-align: left;">
						<p style="font-style: italic; margin-bottom: 0px">Spring Initializer</p>
						<p style="font-size: 50px; margin-top: 0px" ><b>Command Line w/Curl</b></p>

						<pre>
							<code lang="shell" data-trim data-line-numbers style="line-height: 1.4;">
								curl -G https://start.spring.io/starter.tgz \
									-d javaVersion=8 \
									-d dependencies=web,jpa \
									-d name=SpringBootDemo \
									-d groupId=org.example.springbootdemo \
									-d artifactId=SpringBootDemo \
									-d packageName=org.example.springbootdemo \
									-o myfile.tar.gz
							</code>
						</pre>
					</section>
				
				</section>
					
				<!-- -------------------------------------------------------------
					-- Demo: Simple WebService
					------------------------------------------------------------- -->
				<section>

					<section style="text-align: left;">
						<p style="font-style: italic; margin-bottom: 0px">Spring Boot & REST WebService</p>
						<p style="font-size: 50px; margin-top: 0px" ><b>Demo</b></p>
						<span style="font-size: 26px">
							<p>1. Starting WebService without RestController</p>
							<p>2. Creating a simple rest controller (hello)</p>
							<p>3. Calling rest web service : </p>
							<p style="font-family: Courier New, monospace;">curl –G http://localhost:8080/hello?name=Bill</p>
						</span>
					</section>

					<section style="text-align: left;">
						<pre>
							<code lang="java" data-trim data-line-numbers style="line-height: 1.4;">
package com.example.demo;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {
	@RequestMapping("/hello")
	public String hello(String name) {
		return "Hello to " + name;
	}
}
							</code>
						</pre>
					</section>

					<section>
						<img class="stretch" src="images/spring-boot-maven-run.png" alt="Spring-boot-maven-run" style="border: none;">
					</section>
					
				</section>

				<!-- -------------------------------------------------------------
						-- Demo: Greetings Class w/Counter and content
						------------------------------------------------------------- -->
				<section>

					<section style="text-align: left;">
						<p style="font-style: italic; margin-bottom: 0px">MediaType.APPLICATION_JSON_VALUE</p>
						<p style="font-size: 50px; margin-top: 0px" ><b>Demo</b></p>
						<span style="font-size: 26px">
							<p>1. Introducing a Greeting class w/Counter and Greeting content.</p>
							<p>2. Create new WebService "Greeting" configured to return Json.</p>
							<p>3. Calling rest web service : </p>
							<p style="font-family: Courier New, monospace;">curl –G http://localhost:8080/greeting?name=Bill</p>
						</span>
					</section>

					<section>
						<pre>
							<code lang="java" data-trim data-line-numbers style="line-height: 1.4;">
package com.example.demo;

public class Greeting {
	private final long id;
	private final String content;

	public Greeting(long id, String content) {
		this.id = id;
		this.content = content;
	}

	public long getId() {
		return id;
	}

	public String getContent() {
		return content;
	}
}
							</code>
						</pre>
					</section>

					<section>
						<pre>
							<code lang="java" data-trim data-line-numbers style="line-height: 1.4;">
private static final String template = "Hello, %s!";
private final AtomicLong counter = new AtomicLong();

@RequestMapping(value = "/greeting", produces = MediaType.APPLICATION_JSON_VALUE)
public Greeting greeting(@RequestParam(value = "name", defaultValue = "World") String name) {
	return
		new Greeting(counter.incrementAndGet(), String.format(template, name));
}
							</code>
						</pre>
					</section>
				</section>

				<!-- -------------------------------------------------------------
                -- Demo: Testing WebServices
                ------------------------------------------------------------- -->
					<section>
					<section style="text-align: left;">
						<p style="font-style: italic; margin-bottom: 0px">Unit Testing WebServices</p>
						<p style="font-size: 50px; margin-top: 0px" ><b>Demo</b></p>
						<span style="font-size: 26px">
							<p>Extend the DemoApplicationTests class ... </p>
							<p>1. Create a test for failing web service ("morning" - not existing).</p>
							<p>2. Create a test for sucessfull web service call ("greeting").</p>
							<p>3. Create a test checking content type is Json.</p>
							<p>4. Create a test checking increasing counter.</p>
						</span>
					</section>
					<section>
						<pre>
							<code lang="java" data-trim data-line-numbers style="line-height: 1.4;">
package com.example.demo;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.web.client.TestRestTemplate;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class DemoApplicationTests {
	@Autowired
	private TestRestTemplate template;

	@Test
	void contextLoads() {
	}
}
							</code>
						</pre>
					</section>
					<section>
						<pre>
							<code lang="java" data-trim data-line-numbers style="line-height: 1.4;">
package com.example.demo;

import ...
import org.junit.jupiter.api.Test;
import org.springframework.http.ResponseEntity;
import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class DemoApplicationTests {
	@Autowired
	private TestRestTemplate template;

		...

	@Test
	public void checkWrongGreeting() throws Exception {
		ResponseEntity< Greeting > response = template.getForEntity("/morning", Greeting.class);
		assertThat(response.getStatusCode().isError()).isTrue();
	}

}
							</code>
						</pre>
					</section>
					<section>
						<pre>
							<code lang="java" data-trim data-line-numbers style="line-height: 1.4;">
package com.example.demo;

import ...
import org.junit.jupiter.api.Test;
import org.springframework.http.ResponseEntity;
import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class DemoApplicationTests {
	@Autowired
	private TestRestTemplate template;

	@Test
	public void checkOkGreeting() throws Exception {
		String name = "bill";
		ResponseEntity< Greeting > response = template.getForEntity("/greeting?name=" + name, Greeting.class);

		assertThat(response.getStatusCode().is2xxSuccessful()).isTrue();
		assertThat(response.getBody().getContent().equals(String.format("Hello, %s", name)));
	}
}
							</code>
						</pre>
					</section>
					<section>
						<pre>
							<code lang="java" data-trim data-line-numbers style="line-height: 1.4;">
package com.example.demo;

import ...
import org.junit.jupiter.api.Test;
import org.springframework.http.ResponseEntity;
import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class DemoApplicationTests {
	@Autowired
	private TestRestTemplate template;

	@Test
	public void checkContentTypeJSON() throws Exception {
		String expectedType = MediaType.APPLICATION_JSON_VALUE;
		ResponseEntity< Greeting > response = template.getForEntity("/greeting", Greeting.class);
		assertThat(expectedType).isEqualTo(response.getHeaders().getContentType().toString());
	}
}
							</code>
						</pre>
					</section>
				</section>

            <!-- --------------------------------------------------------
               -- Next
               ------------------------------------------------------------- -->
            <section data-background="black">
               <p style="font-style: italic; margin-bottom: 0px">Next</p>
               <p style="font-size: 0px; margin-top: 0px" ><a href="ws-03-rest-store.html"><b>Web Services: Rest Store</b></a></p>
               <p style="font-size: 18px"><a href="index.html">Home</a></p>
            </section>

         </div>
     </div>

      <script src="dist/reveal.js"></script>
      <script src="plugin/notes/notes.js"></script>
      <script src="plugin/markdown/markdown.js"></script>
      <script src="plugin/highlight/highlight.js"></script>
      <script>
         // More info about initialization & config:
         // - https://revealjs.com/initialization/
         // - https://revealjs.com/config/
         Reveal.initialize({
            hash: true,
            margin: 0.2,
            transition: 'fade',

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
         });
      </script>
   </body>
</html>
